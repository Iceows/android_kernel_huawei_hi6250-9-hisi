

#ifndef __MEM_TRACE_H__
#define __MEM_TRACE_H__

#ifdef __cplusplus
#if __cplusplus
extern "C" {
#endif
#endif

#if defined(_PRE_MEM_TRACE)
#include "oal_types.h"

/**
 @brief ???????????????????????????
 @param[in] none
 @return    oal_void
 @note  ??????????????????????????????????????????????
*/
extern oal_void mem_trace_init(oal_void);

/**
 @brief ????????????????????????????
 @param[in] none
 @return    oal_void
 @note  ????????????????????????????????????????????????
        ????????????????????????????????????????????????????????????
        ????????????????????????????????????????????????
*/
extern oal_void mem_trace_exit(void);

/**
 @brief ??????????????????????????????????
 @param[in] ul_mode     ????0:????????????????????????????????????????????????????
                        ????1:??????????????????????????????
                        ????2:??????????????????????????????????

 @param[in] ul_fileid   ????????????????????:??????
 @param[in] ul_linenum  ????????????????????:????
 @return    oal_void
 @note  ????????????????printk????????????????????????????
*/
extern oal_void mem_trace_info_show(oal_uint32 ul_mode,
                                    oal_uint32 ul_fileid,
                                    oal_uint32 ul_line);
#ifdef _PRE_SKB_TRACE
/**
 @brief ??????????????????????????????????????????????????????????????????(??????+????)
 @param[in] ul_addr     ??????????????????
 @param[in] ul_fileid   ????????????????????:??????
 @param[in] ul_linenum  ????????????????????:????
 @return    oal_void
 @note  ??????????????????????????????????????????????????????????????????????
        ????????????????????????????????skb????????????????????????????skb????????????????????????????:

     _oal_netbuf_alloc()????????????????????????????????????????

     #ifdef _PRE_SKB_TRACE
     #define oal_netbuf_alloc(size,l_reserve,l_align)        \
     ({\
         oal_netbuf_stru *pst_netbuf;\
         pst_netbuf = _oal_netbuf_alloc(size,l_reserve,l_align);\
         if(pst_netbuf)\
         {\
             mem_trace_add_node((oal_size_t)pst_netbuf, THIS_FILE_ID, (oal_uint32)__LINE__);\
         }\
         pst_netbuf;\
     })
     #else
     #define oal_netbuf_alloc(size,l_reserve,l_align) _oal_netbuf_alloc(size,l_reserve,l_align)
     #endif
*/
extern oal_void __mem_trace_add_node(oal_ulong   ul_addr,
                                     oal_uint32  ul_fileid,
                                     oal_uint32  ul_linenum);

/**
 @brief ????????????????????
 @param[in] ul_addr     ??????????????????
 @return    oal_void
 @note  ????????????????????????????????????????????????????????????????????????
        ??????????????????????????????????????????????????

        ??????????????????????????????????????????????????????????????????????????????????
        ????????????????????????????skb????????????????????????????skb????????????????????????:

     _oal_netbuf_free()????????????????????????????????????????

     #ifdef _PRE_SKB_TRACE
     #define oal_netbuf_free(pst_netbuf)        \
     ({\
         mem_trace_delete_node((oal_size_t)pst_netbuf);\
         _oal_netbuf_free(pst_netbuf);\
     })
     #else
     #define oal_netbuf_free(pst_netbuf) _oal_netbuf_free(pst_netbuf)
     #endif
*/
extern oal_void __mem_trace_delete_node(oal_ulong   ul_addr,
                                        oal_uint32  ul_fileid,
                                        oal_uint32  ul_linenum);


/**
 @brief ??????????????????????????????????????????????????????????????????????
 @param[in] ul_addr     ??????????????????
 @param[in] ul_fileid   ????????????????????:??????
 @param[in] ul_linenum  ????????????????????:????
 @return    oal_void
 @note  ????????????????????????????????????????????????????????????????????????????????????????????????
        ????????????????????????????????????

        ??????????????????????????mem_trace_info_show????????????????????????????????????????????????????
        ????????????????????????????????????????????????????????????????????????????????????????????????
        ??????????????
*/
extern oal_void __mem_trace_probe(oal_ulong  ul_addr,
                                  oal_uint32 ul_probe_fileid,
                                  oal_uint32 ul_probe_line);



#define mem_trace_add_node(ul_addr) \
        __mem_trace_add_node(ul_addr, THIS_FILE_ID, __LINE__)
#define mem_trace_delete_node(ul_addr) \
        __mem_trace_delete_node(ul_addr, THIS_FILE_ID, __LINE__)
#define mem_trace_probe(ul_addr) \
        __mem_trace_probe(ul_addr, THIS_FILE_ID, __LINE__)
#endif

#ifdef __cplusplus
#if __cplusplus
}
#endif
#endif

#endif
#endif

